\documentclass[documentclass]{jsarticle}
%ディジタル信号処理 Matlab演習1
\usepackage[top=25truemm,bottom=25truemm,left=20truemm,right=20truemm]{geometry}
\usepackage{listings, jlisting, color}
\usepackage[dvipdfmx]{graphicx}
\usepackage{pdfpages}
\usepackage{amsmath}
\usepackage{amssymb, latexsym}
\usepackage{mathtools}
\usepackage{multirow}
\usepackage{color}
\usepackage{ulem}
\usepackage{here}
\usepackage{wrapfig}
\usepackage{tikz}
\usepackage{tcolorbox}
\tcbuselibrary{breakable, skins, theorems}

% 使用する関数の宣言
% （最低限これさえ宣言していれば十分だと思われるものを書いています）
\usetikzlibrary{intersections, calc, arrows, positioning, arrows.meta}


\newcommand{\Add}[1]{\textcolor{red}{#1}}
\newcommand{\Erase}[1]{\textcolor{red}{\sout{\textcolor{black}{#1}}}}
\newcommand{\ctext}[1]{\raise0.2ex\hbox{\textcircled{\scriptsize{#1}}}}

\lstset{
  basicstyle={\small},
  breaklines=true,
  frame=single,
  tabsize=3,
  numbers=left
}

\begin{document}
\title{ソフトウェア設計演習 最終レポート}
\author{222C1021 今村優希}
\maketitle

%\tableofcontents
\clearpage

\newpage

\section{今回のシステム}

今回は下記仕様の「Live Campus」のようなシステムをモデル化する．
システムの大まかな概要を下記に記す．

\begin{tcolorbox}
  \begin{itemize}
    \item 学生は毎学期ごとに、システムから履修登録を行い、許可された講義を受講する。
    履修の可否は、学修細則に基づきシステムが判断する。
    各学期ごとに履修できる科目数には上限があり、同じ時限に重複した科目を履修することはできない。
    \item 学生は、履修登録期間内には何度でも登録、削除、修正(更新)を行うことが出来る。
    \item 学生は、登録した科目と登録可能な科目の時間割をそれぞれ見ることが出来る。
    \item 学生は、自身のこれまでの成績を確認することができる。
    \item 科目には、必修と選択があり、不合格の必修科目があれば履修登録時にシステムが提示し、履修を促す。
    \item 教員は、複数の科目を担当することがあり、システムから各科目の成績を報告する。
    なお、科目担当者は1名とする。
    \item システムは、成績報告期限までに報告していない教員に督促メールを送る。
    なお、成績報告期限の1週間前に成績報告していない教員には、期限を知らせるメールを送るものとする。
  \end{itemize}
\end{tcolorbox}

\section{設計の作成手順}
今回の設計では，分析モデルを作成した後に，設計モデルを作成する手順を取った．

分析モデルでは以下のUML図を作成した．
各UML図が作成し終わると，レビューを行い，後の工程に大きな影響が出ないように工夫を行った．
\begin{itemize}
  \item ユースケース図
  \item ユースケース記述
  \item クラス図
  \item シーケンス図
  \item アクティビティ図
  \item ステートマシン図
\end{itemize}


\newpage

\section{ユースケース図}
システムの概要を把握するためにユースケース図を作成した．
\subsection*{作成}
今回のシステムの内容から，必要なアクターは
\begin{itemize}
  \item 学生
  \item 教員
\end{itemize}
であると考えた．
学生は

\subsection*{レビュー結果メモ}
\begin{itemize}
  \item ユースケースが多く詳細過ぎると思ったので，一部ユースケースを統合した．
  \item アクターとして「外部システム」という名称でアクターを追加していたが，
  何の役割があるのかはっきりしていなかったため，「チケット購入補助」に名称を変更した．
  \item アクターとして「サーバー」を追加していたが，システム内に組み込まれていると把握したので削除した．
\end{itemize}

\subsection*{作成結果}
これらの考えのもと作成したユースケース記述が図である．
付け加えた機能のために考えたユースケースを青で表示した．

%ユースケース図の作成結果
\begin{figure}[H]
  \begin{center}
    \includegraphics*[scale=0.4]{figure/3-1.png}
  \end{center}
  \caption{ユースケース図}
  \label{fig:3-1}
\end{figure}
\newpage

\section{ユースケース記述}
上記で作成したユースケースすべてに対してユースケース記述の作成を行った．
\subsection*{概要と作成結果}
\subsubsection*{1. 乗車・下車}
乗車し，降車するまでの一連の流れを記述で確認した．
作成したユースケース記述は図である．

%乗車・下車のユースケース記述
\begin{figure}[H]
  \begin{center}
    \includegraphics*[scale=0.6]{figure/4-1.png}
  \end{center}
  \caption{乗車・下車のユースケース記述}
  \label{fig:4-1}
\end{figure}

\subsubsection*{2. チケットを購入する}
チケットを購入するまでの流れをユースケース記述で確認した．
利用者はサーバーを通じてチケットの購入結果がわかるのでシステムのバグが減るよう工夫した．

%チケット購入のユースケース記述
\begin{figure}[H]
  \begin{center}
    \includegraphics*[scale=0.6]{figure/4-2.png}
  \end{center}
  \caption{チケット購入のユースケース記述}
  \label{fig:4-2}
\end{figure}

\subsubsection*{3. ダイヤを確認する}
ダイヤ確認のユースケース記述を作成した．

%ダイヤ確認のユースケース記述
\begin{figure}[H]
  \begin{center}
    \includegraphics*[scale=0.6]{figure/4-3.png}
  \end{center}
  \caption{ダイヤ確認のユースケース記述}
  \label{fig:4-3}
\end{figure}

\subsubsection*{4. ダイヤを登録する}
大学の事務が行うダイヤ登録をユースケース記述で動作を確認した．

%ダイヤ登録のユースケース記述
\begin{figure}[H]
  \begin{center}
    \includegraphics*[scale=0.6]{figure/4-4.png}
  \end{center}
  \caption{ダイヤ登録のユースケース記述}
  \label{fig:4-4}
\end{figure}

\subsubsection*{5. 乗降の記録と取る}
1によって利用者が乗車・下車を行ったのでその情報を保存するための記述を作成した．
このユースケースの動作は，システムに内包されている「読み取り機」からの通知を元にサーバー側での動作がメインである．
したがって，失敗がない前提で考えた．
下車することでチケットを更新することで，システム場でのエラーを回避するよう工夫した．
また，チケットの更新は6.チケットの管理と協力して行うように工夫した．

%乗降の記録のユースケース記述
\begin{figure}[H]
  \begin{center}
    \includegraphics*[scale=0.6]{figure/4-5.png}
  \end{center}
  \caption{乗降の記録を取るのユースケース記述}
  \label{fig:5-4}
\end{figure}

\subsubsection*{6. チケットを管理する}
2によって利用者はチケットを購入し，5によってチケットが更新される．
これらをまとめて管理するユースケース記述を作成した．


%チケットを管理のユースケース記述
\begin{figure}[H]
  \begin{center}
    \includegraphics*[scale=0.6]{figure/4-6.png}
  \end{center}
  \caption{チケットを購入するのユースケース記述}
  \label{fig:4-6}
\end{figure}

\subsubsection*{o1. バスの位置を確認する}
利用者がバスの位置を得るまでの流れをユースケース記述で確認した．
今回のシステムで記述した通り，位置情報は緯度経度で表すことにしたので，システムはかなりシンプルにできた．

%バスの位置を確認するユースケース記述
\begin{figure}[H]
  \begin{center}
    \includegraphics*[scale=0.6]{figure/4-7.png}
  \end{center}
  \caption{バスの位置を確認するのユースケース記述}
  \label{fig:4-7}
\end{figure}

\subsubsection*{o2. バスの位置を保存する}
バス側で位置を取得すると，その情報をサーバーにアップロードする．
位置取得は分単位と高頻度で行うとする．
ここで工夫したのは，エラーが起きてもその対策とする代替系列を作成しなかったことだ．
基本的に高頻度で情報がアップロードされるので，次の情報を待つようにした．

%バスの位置を保存するユースケース記述
\begin{figure}[H]
  \begin{center}
    \includegraphics*[scale=0.6]{figure/4-8.png}
  \end{center}
  \caption{バスの位置を保存するのユースケース記述}
  \label{fig:4-8}
\end{figure}

\subsection*{レビュー}
\begin{itemize}
  \item いくつかのユースケース記述(2, 3)で，何を用いて動作を行っているかが欠如していた．
  今回はwebアプリを用いて行うことにし，ユースケース記述の更新を行った．
  \item 代替系列ができていない部分があったので訂正を加えた．
\end{itemize}

\newpage

\section{クラス図}
\subsection*{概要}
システム概要とユースケース記述からクラス図の作成を行った．
まず，その概要から挙げられたクラス図を以下に列挙する．
ネストで表しているのは汎化関係(g)，集約関係(a)を表している．
ネストで表しても大丈夫なのかわからなかったが，文章でわかりやすくするために今回はネストを使用した．
\begin{itemize}
  \item システム利用者 このシステムを利用する人をまとめたクラスである．
  このクラスには乗客と事務と2つのクラスが関連している．
  このクラスには利用者IDと利用者用の名前等のデータが保存されている．
  \begin{itemize}
    \item[a] 乗客 乗客には乗客の名前がデータとして保存されている． 
    メソッドとして，乗車・下車，ダイヤ確認，スマホをかざす等，乗客が直接行う動作を加えている．
    これらメソッドを利用するためのクラスが関連付けられている．
    \item[a] 事務 事務は，ダイヤを登録する人を指すクラスである．
    ダイヤと関連付けられている．
  \end{itemize}
  \item ダイヤ 事務と1乗客に関連付けられている．
  \item スマホ 乗客とチケットに関連付けられている．
  \item バス 乗客と関連付けられている．
  \begin{itemize}
    \item[g] チケット読み取り機 チケットとサーバーと関連付けられている．
    チケットを読み取るとサーバーに通知が行き，サーバーが読み取り機に対して返答を出す．
  \end{itemize}
  \item チケット スマホと関連付けられている
  \begin{itemize}
    \item[a] 回数券
    \item[a] 月利用券
  \end{itemize}
  \item 外部システム チケットを購入するために使用する．
  サーバー関連づいている．
  \begin{itemize}
    \item[a] 生協アプリ
    \item[a] クレジット会社
  \end{itemize}
  \item サーバー ダイヤ等を保存している．
  情報受付と行い，必要な情報をアップロードする．
\end{itemize}
それから，このシステムを動作させる上で必要だと思ったものをクラスとして定義を行った．
\begin{itemize}
  \item[バス位置] バスの位置等を持つクラスである．
  サーバーや利用者が使うためクラスとして独立させた．   
\end{itemize}
\subsection*{レビュー結果メモ}
\begin{itemize}
  \item 複数のクラスが不要だったので削除した．同時に必要なクラスを追加した
  \item クラス内のメソッドが不十分であったものに対して追加を行った．
  \item 重複度を記載していない部分があったので加えた
  \item クラス図の配置を変更した
\end{itemize}

\subsection*{作成したもの}
作成できたものは図である．

%クラス図の表示
\begin{figure}[H]
  \begin{center}
    \includegraphics*[scale=0.3]{figure/5-1.png}
  \end{center}
  \caption{クラス図}
  \label{fig:5-1}
\end{figure}

\newpage

\section{シーケンス図}
\subsection*{概要}
作成したシーケンス図は乗降用，チケット購入用，のシーケンス図を作成した．
基本的にユースケース記述に記載したことをそのまま実現した．
これらの図にはクラス図で出てきたもののみを用いて実現するよう工夫した．
要するに，新しいクラスを作るような作業は行わなかった．

\subsection*{レビュー結果メモ}
\begin{itemize}
  \item ユースケース記述との相違点があったので，順番を入れ替える等の作業を行った
\end{itemize}
\subsection*{作成した図}

%乗降用のシーケンス図
\begin{figure}[H]
  \begin{center}
    \includegraphics*[scale=0.3]{figure/6-1.png}
  \end{center}
  \caption{チケット購入用のシーケンス図}
  \label{fig:6-1}
\end{figure}
%チケット購入のシーケンス図
\begin{figure}[H]
  \begin{center}
    \includegraphics*[scale=0.4]{figure/6-2.png}
  \end{center}
  \caption{チケット購入用のシーケンス図}
  \label{fig:6-2}
\end{figure}

\newpage

\section{アクティビティ図}
\subsection*{概要}
作成したアクティビティ図は「バスの位置を確認する」と「バスの位置を記録する」である．


\subsection*{作成した図}

%バスの位置を確認するアクティビティ図
\begin{figure}[H]
  \begin{center}
    \includegraphics*[scale=0.4]{figure/7-1.png}
  \end{center}
  \caption{バスの位置に関するアクティビティ図}
  \label{fig:7-1}
\end{figure}

\newpage

\section{ステートマシン図}
\subsection*{概要}
作成したステートマシン図は「回数券」「月利用券」の2種類である．

チケットを購入すると使用待機中に遷移する．
乗降を持って1回の使用が終わり，そこで残りの回数が0回か1回以上かで取りうる状態が異なるよう設計した．
月利用券は，定期券と同じで使用期間が設定されているという判断をした．
使用待機中から使用できるのは，使用期限以内に設定し，期限が切れると同時に「期限切れ」に状態が遷移する．

\subsection*{レビュー}

%回数券ようのステートマシン図
\begin{figure}[h]
  \centering
  \begin{minipage}[b]{0.49\columnwidth}
      \centering
      \includegraphics[width=0.9\columnwidth]{figure/8-1.png}
      \caption{回数券のステートマシン図}
      \label{fig:8-1}
  \end{minipage}
  \begin{minipage}[b]{0.49\columnwidth}
      \centering
      \includegraphics[width=0.9\columnwidth]{figure/8-2.png}
      \caption{利用券のステートマシン図}
      \label{fig:8-2}
  \end{minipage}
  \end{figure}


\section{まとめ}
前回使用したUML図に対して複数回のレビュー訂正を行い今回のレポート作成を行った．
クラス図，シーケンス図に関してはまだ理解できていない部分があり，大きく訂正を要した．
クラス図に関しては，クラスが多すぎて図がわかりにくくなってしまった．
今後の作成でクラスの数は意識していきたい．

レビューを図を作成する事に行ったので，後の図の作成に与える影響が少なかったのは良かった．
影響が少ないというよりは，事前に作った図を元に次の図を作成したので，前の図とあっていない等のミスは減った．
今後の作成においても，図を作成するごとにレビューを行い，後の作業に影響を与えないように工夫したい．

\end{document}